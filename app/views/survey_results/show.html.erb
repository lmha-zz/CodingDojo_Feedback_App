<%= content_for :title do %>
  CodingDojo Feedbacks Admin
<% end %>

<%= render "shared/admin_navbar"%>

<div class="contentWrapper">
  <div class="row">
    <div class="col-sm-10 col-sm-offset-1">
      <% if @all_surveys.any? %>
        <table class="table table-bordered table-striped">
          <thead>
            <tr class="active">
              <th>Title</th>
              <th>Name</th>
              <th>Time</th>
              <th>Summary</th>
            </tr>
          </thead>
          <tbody>
            <% @all_surveys.each do |survey| %>
            <% i = 1 %>
              <tr>
                <td><%= Survey.find(survey.id).title %></td>
                <td><%= Survey.find(survey.id).author %></td>
                <td><%= time_ago_in_words(Survey.find(survey.id).created_at) %> ago</td>
                <td class="tooltips" title="<% Survey.find(survey.id).survey_results.all.each do |result| %><% if(result.respondent_name.blank?)%><%= "respondent #{i}" %><% else %><%= result.respondent_name %><% end %> - <%= result.helpful_scale %><% if(!result.feedback.blank?)%><%= " (#{result.feedback})" %><% end %><% if (result != Survey.find(survey.id).survey_results.last) %>,&#013;<% end %><% i += 1 %><% end %>"><%= Survey.find(survey.id).survey_results.average(:helpful_scale).round(2) %> (<%= Survey.find(survey.id).survey_results.count %> responses)</td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <p>No surveys results have been submitted at the moment.</p> 
      <% end %>
    </div>
  </div>
</div>

<%= render partial: "shared/admin_active_menu_jQuery" %>
<script>
  if(window.location.href.indexOf('/survey_results/show') != -1) {
    $('nav > .container').append('<ul class="nav navbar-nav navbar-right"><li><a href="#top">Back to top</a></li></ul>')
  }
  $('#top').on('click', function() {
    window.scrollTo(0,0);
  })
  $(document).tooltip();
  $( ".tooltips" ).tooltip({
    position: { my: "left top+15", at: "right top+5", collision: "flipfit" }
  });
</script>